# Структура исполняемого модуля. Загрузка программы на исполнение.

## **1. Структура исполняемого модуля**

Исполняемый модуль (например, `ELF` в Linux, `PE` в Windows, `Mach-O` в macOS) — это бинарный файл, содержащий машинный код, данные и метаданные, необходимые для загрузки и выполнения программы. Его структура включает несколько ключевых компонентов.

### **① Форматы исполняемых файлов**

* **ELF** (Executable and Linkable Format) — Linux, BSD.
* **PE** (Portable Executable) — Windows (.exe, .dll).
* **Mach-O** — macOS, iOS.

### **② Основные компоненты (на примере ELF)**


| Компонент                                | Описание                                                                                                     |
| ------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------- |
| **ELF Header**                                    | Общая информация: тип файла, архитектура, точка входа (`_start`).        |
| **Program Headers**                               | Описание сегментов (сегмент кода, данных, стек) для загрузчика.   |
| **Секции**                                  | `.text`, `.data`, `.rodata`, `.bss` (аналогично объектному файлу).                          |
| **Динамическая информация** | Таблицы для динамической компоновки (использование библиотек). |
| **Символы**                                | Таблица символов (если не удалена`strip`).                                               |

## 2. Загрузка программы на исполнение (см. билет 15)

Процесс загрузки программы в память и передачи управления включает несколько этапов.

### **① Роль загрузчика (Loader)**

Загрузчик (например, `ld-linux.so` в Linux) выполняет:

1. **Чтение заголовков** файла и проверку совместимости.
2. **Выделение памяти** под сегменты кода/данных.
3. **Динамическую компоновку** (если используются разделяемые библиотеки).
4. **Передачу управления** на точку входа (`_start`).

### **② Этапы загрузки**

1. **Запуск программы** (пользователь вводит `./program`).
2. **Парсинг ELF-заголовка**
   * Ядро проверяет магическое число (`0x7F 'E' 'L' 'F'`).
   * Определяет архитектуру и тип файла.
3. **Отображение в память**
   * Сегменты кода (`.text`) и данных (`.data`) загружаются в RAM.
   * Область `.bss` обнуляется.
4. **Динамическая компоновка**
   * Загрузчик ищет разделяемые библиотеки (`libc.so`).
   * Резидентные библиотеки загружаются через `mmap`.
5. **Инициализация**
   * Выполняются конструкторы глобальных объектов (для C++).
   * Передача аргументов командной строки (`argc`, `argv`).
6. **Переход к `_start`**
   * Управление передаётся на точку входа, затем вызывается `main()`.
